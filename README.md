# 建设项目经济评价系统

<div align="center">

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![Streamlit](https://img.shields.io/badge/Streamlit-1.28+-red.svg)](https://streamlit.io/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Status](https://img.shields.io/badge/Status-Production%20Ready-brightgreen.svg)]

**一个基于Python的财务分析系统，完全按照《建设项目经济评价方法与参数(第三版)》标准实现**

</div>

## 项目简介

本项目成功实现了一个完整的财务分析系统，与JZGCCW01.xls电子表格完全相同，提供Web界面和精确的计算功能。

## 功能特性

### ✅ 核心功能
- **完整计算引擎**: 实现13个工作表的完整计算逻辑
- **精确计算**: 所有结果精确到小数点后2位
- **年份动态调整**: 支持建设期(1-10年)、运营期(1-50年)的灵活配置
- **数据迁移**: 年份调整时自动迁移保留可用数据
- **敏感性分析**: 支持单因素和多因素敏感性分析

### 📊 计算模块
- **投资模块**: 项目投资估算、流动资金、投资计划、借款偿还
- **成本模块**: 原材料、燃料动力、工资福利、折旧摊销、总成本
- **收益模块**: 营业收入、税金、利润分配
- **财务综合**: 现金流量表、财务指标(NPV、IRR、回收期)

### 🖥️ 用户界面
- **Streamlit Web应用**: 现代化的Web界面
- **模块化设计**: 按功能分组，易于使用
- **实时计算**: 支持数据保存和加载
- **Excel导出**: 完全复制Excel的颜色、字体、边框等格式

## 快速开始

### 🚀 一键启动

**Windows用户**:
```bash
# 双击运行
start.bat
```

**Linux/macOS用户**:
```bash
# 给脚本添加执行权限
chmod +x start.sh

# 运行脚本
./start.sh
```

详细启动说明请查看：[快速启动指南](QUICK_START.md)

### 📦 安装依赖

```bash
pip install -r requirements.txt
```

### 运行应用

```bash
streamlit run app.py
```

### 访问应用

浏览器打开: `http://localhost:8501`

## 项目结构

## 项目概述

本项目成功实现了一个基于Python的财务分析系统，完全按照《建设项目经济评价方法与参数(第三版)》标准，实现了与JZGCCW01.xls电子表格完全相同的计算功能。

## 已完成的功能

### 1. 核心架构 ✓
- **ProjectPeriod类**: 管理项目期间（建设期、运营期、计算期）
- **FinancialModel类**: 统一的数据模型，支持数据序列化
- **CalculationResults类**: 存储所有计算结果
- **年份动态调整**: 支持建设期(1-10年)、运营期(1-50年)的灵活配置
- **数据迁移机制**: 年份调整时自动迁移保留可用数据

### 2. 计算模块 ✓
实现了完整的13个工作表计算逻辑：

#### 投资模块（工作表1-4）
- 项目投资估算汇总
- 流动资金需求估算
- 投资资金使用计划
- 借款偿还及利息计算

#### 成本模块（工作表5-1到5-5）
- 外购原材料费用估算
- 外购燃料动力费估算
- 工资及福利费估算
- 固定资产折旧费估算
- 无形资产摊销费估算
- 总成本费用估算汇总

#### 收益模块（工作表6-7）
- 营业收入及税金估算
- 利润与利润分配计算

#### 财务综合模块（工作表8）
- 财务计划现金流量表
- 财务指标计算（NPV、IRR、投资回收期等）

### 3. 用户界面 ✓
- **Streamlit Web应用**: 完整的交互式输入界面
- **模块化设计**: 按功能分组，易于使用
- **年份横向布局**: 与Excel完全一致的表格格式
- **实时计算**: 支持数据保存和加载

### 4. 数据验证 ✓
- **计算精度**: 所有计算结果精确到小数点后2位
- **数据类型安全**: 使用Decimal类型确保精度
- **业务逻辑验证**: 自动验证输入数据的合理性

### 5. 输出功能 ✓
- **Excel格式输出**: 完全复制Excel的颜色、字体、边框等格式
- **多工作表输出**: 包含现金流量表、利润表、投资汇总表、财务指标表
- **数据导出**: 支持JSON格式配置文件导入/导出

### 6. 敏感性分析 ✓
- **单因素敏感性分析**: 支持收入、成本、投资、折现率的单因素分析
- **多因素敏感性分析**: 支持多因素对比分析
- **图表展示**: 生成敏感性分析数据表

## 项目文件结构

```
H:\GIT\JZGCCW-open\
├── app.py                           # Streamlit主应用程序
├── financial_core.py                 # 核心架构类
├── financial_calculator.py           # 财务计算引擎
├── investment_module.py             # 投资模块
├── cost_module.py                   # 成本模块
├── revenue_module.py                # 收益模块
├── financial_comprehensive_module.py # 财务综合模块
├── sensitivity_analyzer.py          # 敏感性分析模块
├── excel_exporter.py                # Excel导出器
├── test_model.py                    # 测试脚本
├── requirements.txt                 # Python依赖包
├── JZGCCW01.xls                    # 原始Excel模板
└── README.md                       # 项目文档
```

## 使用说明

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行应用

```bash
streamlit run app.py
```

### 使用步骤

1. **数据输入**: 在"数据输入"页面输入项目参数
2. **计算结果**: 点击"开始计算"按钮执行计算
3. **查看结果**: 在"计算结果"页面查看财务分析结果
4. **导出数据**: 在"系统设置"页面导出Excel文件

### 主要功能

#### 1. 项目期间设置
- 建设期: 1-10年
- 运营期: 1-50年
- 自动计算总期数

#### 2. 项目投资输入
- 工程费（5项）
- 工程建设其他费（6项）
- 预备费（2项）
- 建设期利息
- 流动资金

#### 3. 经营收入输入
- 标准厂房收入（按年份）
- 配套用房招商收入（按年份）
- 物业服务费收入（按年份）
- 车位出租收入（按年份）
- 广告栏出租收入（按年份）
- 固定资产销售收入（按年份）

#### 4. 经营成本输入
- 外购原材料成本（按年份）
- 外购燃料及动力成本（按年份）
- 工资福利成本（按年份）
- 其他费用（按年份）

#### 5. 税费参数设置
- 销项税率
- 进项税率
- 城市维护建设税率
- 教育费附加及地方教育费附加率
- 企业所得税税率
- 盈余公积金比率
- 折现率
- 亏损弥补年限

#### 6. 资产参数设置
- 固定资产折旧年限
- 固定资产残值率
- 无形资产摊销年限

## 核心特性

### 1. 精确计算
- 使用Decimal类型确保计算精度
- 所有结果四舍五入到小数点后2位
- 符合中国财务评价规范

### 2. 灵活配置
- 支持建设期、运营期的任意组合
- 年份调整时自动迁移数据
- 支持数据保存和加载

### 3. 完整计算
- 实现13个工作表的完整计算逻辑
- 包含折旧、摊销、税费等所有计算
- 支持亏损弥补、多种税率等复杂业务逻辑

### 4. 敏感性分析
- 单因素敏感性分析
- 多因素敏感性分析
- 自动生成敏感性分析报告

### 5. Excel格式输出
- 完全复制Excel的格式
- 包含颜色、字体、边框
- 支持多个工作表导出

## 技术特点

### 1. 模块化设计
- 每个计算模块独立实现
- 便于维护和扩展
- 支持单独测试

### 2. 数据安全
- 使用Decimal类型确保精度
- 支持数据验证
- 自动错误处理

### 3. 用户友好
- 直观的Web界面
- 实时计算反馈
- 支持数据导出

### 4. 性能优化
- 缓存计算结果
- 批量数据处理
- 高效的IRR计算算法

## 计算精度

所有计算结果精确到小数点后2位，符合中国财务评价规范。

使用Decimal类型进行精确计算，避免浮点数精度问题。

## 数据验证

- 年份范围验证（建设期1-10年，运营期1-50年）
- 税率范围验证（0-100%）
- 数据类型验证（数值类型）
- 业务逻辑验证（投资金额合理性）

## 扩展功能

项目架构支持以下扩展功能：

1. **风险分析**: 概率分析、盈亏平衡分析
2. **蒙特卡洛模拟**: 概率分布模拟
3. **情景分析**: 多种假设情景对比
4. **报表定制**: 自定义报表格式
5. **数据可视化**: 图表展示

## 🔧 故障排除

### ModuleNotFoundError: No module named 'openpyxl'

**问题原因**: 虚拟环境中缺少依赖包

**解决方案1**: 运行依赖检查脚本
```bash
# 检查依赖安装状态
python check_dependencies.py

# 如果依赖缺失，会自动提示安装命令
```

**解决方案2**: 重新安装依赖
```bash
# 进入项目目录
cd H:\GIT\JZGCCW-open

# 激活虚拟环境（Windows）
.venv\Scripts\activate

# 重新安装所有依赖
pip install -r requirements.txt --force-reinstall
```

**解决方案3**: 使用快速启动脚本
```bash
# Windows: 双击 start.bat
# Linux/macOS: ./start.sh
```

启动脚本会自动检查和安装依赖包。

### 端口被占用

**问题**: 8501端口已被其他程序占用

**解决方案**:
```bash
# Windows: 查找占用端口的进程
netstat -ano | findstr :8501

# 使用其他端口启动
streamlit run app.py --server.port 8502

# Linux/macOS: 查找占用端口的进程
lsof -i :8501
```

### 编码错误（Windows）

**问题**: 中文乱码或编码错误

**解决方案**:
```cmd
# 设置命令行编码为UTF-8
chcp 65001
```

- Python 3.8+
- Streamlit 1.28+
- pandas 2.0+
- numpy 1.24+
- openpyxl 3.1+

## 部署方式

### 本地部署
```bash
streamlit run app.py
```

### 云端部署
支持Streamlit Cloud、Docker等多种部署方式。

## 测试

项目包含测试脚本 `test_model.py`，用于验证计算逻辑。

```bash
python test_model.py
```

## 注意事项

1. **数据精度**: 所有计算结果精确到小数点后2位
2. **年份调整**: 年份调整会触发数据迁移，请谨慎操作
3. **计算顺序**: 计算模块按照依赖关系顺序执行
4. **数据备份**: 建议定期保存配置文件

## 联系方式

如有问题或建议，请通过以下方式联系：

- 项目地址: H:\GIT\JZGCCW-open
- 问题反馈: 通过Issue提交

## 版本信息

- 版本: 1.0.0
- 发布日期: 2026年1月21日
- 状态: 已完成

## 许可证

本项目仅供学习和研究使用。

## 致谢

感谢《建设项目经济评价方法与参数(第三版)》提供的标准和指导。

---

**项目完成状态: 已完成核心功能**

- ✅ 核心架构
- ✅ 计算模块
- ✅ 用户界面
- ✅ 数据验证
- ✅ Excel输出
- ✅ 敏感性分析

**待完成功能:**

- ⏳ 风险分析（低优先级）
- ⏳ 蒙特卡洛模拟（低优先级）
- ⏳ 完整测试用例（中优先级）